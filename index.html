<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Berlin Food Voice Assistant</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; text-align: center; padding-top: 50px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        #mic-btn { background-color: #007bff; color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 50px; cursor: pointer; transition: background 0.3s; margin-top: 20px; }
        #mic-btn:hover { background-color: #0056b3; }
        #mic-btn.listening { background-color: #dc3545; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        #status { margin-top: 15px; color: #555; font-style: italic; }
    </style>
</head>
<body>

    <div class="container">
        <h1>Berlin Restaurant Guide ðŸ¥¨</h1>
        <p>Your AI assistant is ready. Click the button below to speak!</p>
        <button id="mic-btn">Start Speaking ðŸŽ¤</button>
        <p id="status">Status: Ready</p>
    </div>

    <script src="https://www.gstatic.com/dialogflow-console/fast/messenger/bootstrap.js?v=1"></script>
    
    <df-messenger
      chat-title="ResRec_Bot"
      agent-id="4c551376-ced2-4df3-b4d5-7c5e99ca7034"
      language-code="en"
      expand="true"> </df-messenger>

    <script>
        const micBtn = document.getElementById('mic-btn');
        const statusText = document.getElementById('status');
        
        // Check browser support for Speech Recognition
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        
        if (!SpeechRecognition) {
            statusText.innerText = "Error: Your browser does not support Speech Recognition.";
            micBtn.style.display = 'none';
        } else {
            const recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'en-US';

            micBtn.addEventListener('click', () => {
                recognition.start();
            });

            recognition.onstart = () => {
                micBtn.classList.add('listening');
                micBtn.innerText = "Listening...";
                statusText.innerText = "Status: I'm listening to you...";
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                statusText.innerText = `You said: "${transcript}"`;
                
                // Send text to Dialogflow Messenger
                const dfMessenger = document.querySelector('df-messenger');
                dfMessenger.renderCustomText(transcript, false);
                
                // FIXED: Use a string 'true' instead of boolean true
                dfMessenger.setAttribute('expand', 'true');
            };

            recognition.onerror = (event) => {
                statusText.innerText = "Status: Error occurred in recognition: " + event.error;
                micBtn.classList.remove('listening');
            };

            recognition.onend = () => {
                micBtn.classList.remove('listening');
                micBtn.innerText = "Start Speaking ðŸŽ¤";
                // Only reset status if it hasn't shown an error
                if(statusText.innerText.includes("listening")) {
                    statusText.innerText = "Status: Ready";
                }
            };
        }
    </script>

</body>
</html>
